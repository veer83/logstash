---
- name: Check if Logstash keystore exists
  stat:
    path: /etc/logstash/logstash.keystore
  register: keystore_exists
  ignore_errors: true

- name: Handle the case when Logstash keystore is not present
  debug:
    msg: "Logstash keystore does not exist"
  when: not keystore_exists.stat.exists

- name: Create Logstash keystore
  command: "/usr/share/logstash/bin/logstash-keystore create --path.settings /etc/logstash/ --stdin"
  args:
    creates: /etc/logstash/logstash.keystore
  when: not keystore_exists.stat.exists

- name: Set Logstash keystore password
  command: echo "simplepassword" | /usr/share/logstash/bin/logstash-keystore add --path.settings /etc/logstash/ --stdin keystore-password
  when: not keystore_exists.stat.exists

- name: Debug output after Logstash keystore setup
  debug:
    msg: "After Logstash keystore setup"
